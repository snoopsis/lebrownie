{"ast":null,"code":"import _regeneratorRuntime from\"/home/snoopsis/nodeSites/lebrownie/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/snoopsis/nodeSites/lebrownie/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/snoopsis/nodeSites/lebrownie/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useReducer}from\"react\";import axios from\"axios\";import AuthContext from\"./authContext\";import authReducer from\"./authReducer\";import setAuthToken from\"../../utils/setAuthToken\";import{REGISTER_SUCCESS,REGISTER_FAIL,CLIENT_LOADED,AUTH_ERROR,LOGIN_SUCCESS,LOGIN_FAIL,LOGOUT,CLEAR_ERRORS,UPDATE_CLIENT,UPDATE_DADOS,UPDATE_PASSWORD}from\"../types\";var AuthState=function AuthState(props){var initialState={token:localStorage.getItem(\"token\"),isAuthenticated:null,loading:true,client:\"\",error:null};var _useReducer=useReducer(authReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];// Load Cliente\nvar loadCliente=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setAuthToken(localStorage.token);_context.prev=1;_context.next=4;return axios.get(\"/api/auth\");case 4:res=_context.sent;dispatch({type:CLIENT_LOADED,payload:res.data});_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);dispatch({type:AUTH_ERROR});case 11:case\"end\":return _context.stop();}}},_callee,null,[[1,8]]);}));return function loadCliente(){return _ref.apply(this,arguments);};}();// Registo de Cliente\nvar register=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(formData){var config,res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:config={headers:{\"Content-Type\":\"application/json\"}};_context2.prev=1;_context2.next=4;return axios.post(\"/api/clientes\",formData,config);case 4:res=_context2.sent;dispatch({type:REGISTER_SUCCESS,payload:res.data});loadCliente();_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](1);dispatch({type:REGISTER_FAIL,payload:_context2.t0.response.data.msg});case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[1,9]]);}));return function register(_x){return _ref2.apply(this,arguments);};}();// Login Cliente\nvar login=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(formData){var config,res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:config={headers:{\"Content-Type\":\"application/json\"}};_context3.prev=1;_context3.next=4;return axios.post(\"/api/auth\",formData,config);case 4:res=_context3.sent;dispatch({type:LOGIN_SUCCESS,payload:res.data});loadCliente();_context3.next=12;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](1);dispatch({type:LOGIN_FAIL,payload:_context3.t0.response.data.msg});case 12:case\"end\":return _context3.stop();}}},_callee3,null,[[1,9]]);}));return function login(_x2){return _ref3.apply(this,arguments);};}();// Update Client\nvar updateDados=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(client){var config,res;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:config={headers:{\"Content-Type\":\"application/json\"}};_context4.prev=1;_context4.next=4;return axios.put(\"/api/clientes/\".concat(client._id),client,config);case 4:res=_context4.sent;dispatch({type:UPDATE_DADOS,payload:res.data});_context4.next=11;break;case 8:_context4.prev=8;_context4.t0=_context4[\"catch\"](1);dispatch({type:AUTH_ERROR,payload:_context4.t0.response.msg});case 11:case\"end\":return _context4.stop();}}},_callee4,null,[[1,8]]);}));return function updateDados(_x3){return _ref4.apply(this,arguments);};}();// Update Client Password\nvar updatePassword=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(client){var config,res;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:config={headers:{\"Content-Type\":\"application/json\"}};_context5.prev=1;_context5.next=4;return axios.put(\"/api/clientes/senha/\".concat(client._id),client,config);case 4:res=_context5.sent;dispatch({type:UPDATE_PASSWORD,payload:res.data});_context5.next=11;break;case 8:_context5.prev=8;_context5.t0=_context5[\"catch\"](1);dispatch({type:AUTH_ERROR,payload:_context5.t0.response.msg});case 11:case\"end\":return _context5.stop();}}},_callee5,null,[[1,8]]);}));return function updatePassword(_x4){return _ref5.apply(this,arguments);};}();// Update Client\nvar updateClient=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(client){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:try{dispatch({type:UPDATE_CLIENT,payload:client});}catch(err){dispatch({type:AUTH_ERROR,payload:err.response.msg});}case 1:case\"end\":return _context6.stop();}}},_callee6);}));return function updateClient(_x5){return _ref6.apply(this,arguments);};}();// Logout\nvar logout=function logout(){return dispatch({type:LOGOUT});};// Clear Errors\nvar clearErrors=function clearErrors(){return dispatch({type:CLEAR_ERRORS});};return/*#__PURE__*/React.createElement(AuthContext.Provider,{value:{token:state.token,isAuthenticated:state.isAuthenticated,loading:state.loading,client:state.client,error:state.error,register:register,loadCliente:loadCliente,login:login,logout:logout,clearErrors:clearErrors,updateClient:updateClient,updateDados:updateDados,updatePassword:updatePassword}},props.children);};export default AuthState;","map":{"version":3,"sources":["/home/snoopsis/nodeSites/lebrownie/client/src/context/auth/AuthState.js"],"names":["React","useReducer","axios","AuthContext","authReducer","setAuthToken","REGISTER_SUCCESS","REGISTER_FAIL","CLIENT_LOADED","AUTH_ERROR","LOGIN_SUCCESS","LOGIN_FAIL","LOGOUT","CLEAR_ERRORS","UPDATE_CLIENT","UPDATE_DADOS","UPDATE_PASSWORD","AuthState","props","initialState","token","localStorage","getItem","isAuthenticated","loading","client","error","state","dispatch","loadCliente","get","res","type","payload","data","register","formData","config","headers","post","response","msg","login","updateDados","put","_id","updatePassword","updateClient","err","logout","clearErrors","children"],"mappings":"6dAAA,MAAOA,CAAAA,KAAP,EAAgBC,UAAhB,KAAkC,OAAlC,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,WAAP,KAAwB,eAAxB,CACA,MAAOC,CAAAA,WAAP,KAAwB,eAAxB,CACA,MAAOC,CAAAA,YAAP,KAAyB,0BAAzB,CACA,OACEC,gBADF,CAEEC,aAFF,CAGEC,aAHF,CAIEC,UAJF,CAKEC,aALF,CAMEC,UANF,CAOEC,MAPF,CAQEC,YARF,CASEC,aATF,CAUEC,YAVF,CAWEC,eAXF,KAYO,UAZP,CAcA,GAAMC,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,CAAAC,KAAK,CAAI,CACzB,GAAMC,CAAAA,YAAY,CAAG,CACnBC,KAAK,CAAEC,YAAY,CAACC,OAAb,CAAqB,OAArB,CADY,CAEnBC,eAAe,CAAE,IAFE,CAGnBC,OAAO,CAAE,IAHU,CAInBC,MAAM,CAAE,EAJW,CAKnBC,KAAK,CAAE,IALY,CAArB,CADyB,gBASCzB,UAAU,CAACG,WAAD,CAAce,YAAd,CATX,4CASlBQ,KATkB,iBASXC,QATW,iBAWzB;AACA,GAAMC,CAAAA,WAAW,0FAAG,2IAClBxB,YAAY,CAACgB,YAAY,CAACD,KAAd,CAAZ,CADkB,sCAIElB,CAAAA,KAAK,CAAC4B,GAAN,CAAU,WAAV,CAJF,QAIVC,GAJU,eAMhBH,QAAQ,CAAC,CACPI,IAAI,CAAExB,aADC,CAEPyB,OAAO,CAAEF,GAAG,CAACG,IAFN,CAAD,CAAR,CANgB,+EAWhBN,QAAQ,CAAC,CAAEI,IAAI,CAAEvB,UAAR,CAAD,CAAR,CAXgB,oEAAH,kBAAXoB,CAAAA,WAAW,0CAAjB,CAeA;AACA,GAAMM,CAAAA,QAAQ,2FAAG,kBAAMC,QAAN,qIACTC,MADS,CACA,CACbC,OAAO,CAAE,CACP,eAAgB,kBADT,CADI,CADA,yCAQKpC,CAAAA,KAAK,CAACqC,IAAN,CAAW,eAAX,CAA4BH,QAA5B,CAAsCC,MAAtC,CARL,QAQPN,GARO,gBAUbH,QAAQ,CAAC,CACPI,IAAI,CAAE1B,gBADC,CAEP2B,OAAO,CAAEF,GAAG,CAACG,IAFN,CAAD,CAAR,CAKAL,WAAW,GAfE,mFAiBbD,QAAQ,CAAC,CACPI,IAAI,CAAEzB,aADC,CAEP0B,OAAO,CAAE,aAAIO,QAAJ,CAAaN,IAAb,CAAkBO,GAFpB,CAAD,CAAR,CAjBa,sEAAH,kBAARN,CAAAA,QAAQ,6CAAd,CAwBA;AACA,GAAMO,CAAAA,KAAK,2FAAG,kBAAMN,QAAN,qIACNC,MADM,CACG,CACbC,OAAO,CAAE,CACP,eAAgB,kBADT,CADI,CADH,yCAQQpC,CAAAA,KAAK,CAACqC,IAAN,CAAW,WAAX,CAAwBH,QAAxB,CAAkCC,MAAlC,CARR,QAQJN,GARI,gBAUVH,QAAQ,CAAC,CACPI,IAAI,CAAEtB,aADC,CAEPuB,OAAO,CAAEF,GAAG,CAACG,IAFN,CAAD,CAAR,CAKAL,WAAW,GAfD,mFAiBVD,QAAQ,CAAC,CACPI,IAAI,CAAErB,UADC,CAEPsB,OAAO,CAAE,aAAIO,QAAJ,CAAaN,IAAb,CAAkBO,GAFpB,CAAD,CAAR,CAjBU,sEAAH,kBAALC,CAAAA,KAAK,8CAAX,CAwBA;AACA,GAAMC,CAAAA,WAAW,2FAAG,kBAAMlB,MAAN,qIACZY,MADY,CACH,CACbC,OAAO,CAAE,CACP,eAAgB,kBADT,CADI,CADG,yCAQEpC,CAAAA,KAAK,CAAC0C,GAAN,yBACCnB,MAAM,CAACoB,GADR,EAEhBpB,MAFgB,CAGhBY,MAHgB,CARF,QAQVN,GARU,gBAchBH,QAAQ,CAAC,CACPI,IAAI,CAAEjB,YADC,CAEPkB,OAAO,CAAEF,GAAG,CAACG,IAFN,CAAD,CAAR,CAdgB,mFAmBhBN,QAAQ,CAAC,CACPI,IAAI,CAAEvB,UADC,CAEPwB,OAAO,CAAE,aAAIO,QAAJ,CAAaC,GAFf,CAAD,CAAR,CAnBgB,sEAAH,kBAAXE,CAAAA,WAAW,8CAAjB,CA0BA;AACA,GAAMG,CAAAA,cAAc,2FAAG,kBAAMrB,MAAN,qIACfY,MADe,CACN,CACbC,OAAO,CAAE,CACP,eAAgB,kBADT,CADI,CADM,yCAQDpC,CAAAA,KAAK,CAAC0C,GAAN,+BACOnB,MAAM,CAACoB,GADd,EAEhBpB,MAFgB,CAGhBY,MAHgB,CARC,QAQbN,GARa,gBAcnBH,QAAQ,CAAC,CACPI,IAAI,CAAEhB,eADC,CAEPiB,OAAO,CAAEF,GAAG,CAACG,IAFN,CAAD,CAAR,CAdmB,mFAmBnBN,QAAQ,CAAC,CACPI,IAAI,CAAEvB,UADC,CAEPwB,OAAO,CAAE,aAAIO,QAAJ,CAAaC,GAFf,CAAD,CAAR,CAnBmB,sEAAH,kBAAdK,CAAAA,cAAc,8CAApB,CA0BA;AACA,GAAMC,CAAAA,YAAY,2FAAG,kBAAMtB,MAAN,sHACnB,GAAI,CACFG,QAAQ,CAAC,CACPI,IAAI,CAAElB,aADC,CAEPmB,OAAO,CAAER,MAFF,CAAD,CAAR,CAID,CAAC,MAAOuB,GAAP,CAAY,CACZpB,QAAQ,CAAC,CACPI,IAAI,CAAEvB,UADC,CAEPwB,OAAO,CAAEe,GAAG,CAACR,QAAJ,CAAaC,GAFf,CAAD,CAAR,CAID,CAXkB,wDAAH,kBAAZM,CAAAA,YAAY,8CAAlB,CAcA;AACA,GAAME,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,SAAMrB,CAAAA,QAAQ,CAAC,CAAEI,IAAI,CAAEpB,MAAR,CAAD,CAAd,EAAf,CAEA;AACA,GAAMsC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,SAAMtB,CAAAA,QAAQ,CAAC,CAAEI,IAAI,CAAEnB,YAAR,CAAD,CAAd,EAApB,CAEA,mBACE,oBAAC,WAAD,CAAa,QAAb,EACE,KAAK,CAAE,CACLO,KAAK,CAAEO,KAAK,CAACP,KADR,CAELG,eAAe,CAAEI,KAAK,CAACJ,eAFlB,CAGLC,OAAO,CAAEG,KAAK,CAACH,OAHV,CAILC,MAAM,CAAEE,KAAK,CAACF,MAJT,CAKLC,KAAK,CAAEC,KAAK,CAACD,KALR,CAMLS,QAAQ,CAARA,QANK,CAOLN,WAAW,CAAXA,WAPK,CAQLa,KAAK,CAALA,KARK,CASLO,MAAM,CAANA,MATK,CAULC,WAAW,CAAXA,WAVK,CAWLH,YAAY,CAAZA,YAXK,CAYLJ,WAAW,CAAXA,WAZK,CAaLG,cAAc,CAAdA,cAbK,CADT,EAiBG5B,KAAK,CAACiC,QAjBT,CADF,CAqBD,CA7KD,CA+KA,cAAelC,CAAAA,SAAf","sourcesContent":["import React, { useReducer } from \"react\";\nimport axios from \"axios\";\nimport AuthContext from \"./authContext\";\nimport authReducer from \"./authReducer\";\nimport setAuthToken from \"../../utils/setAuthToken\";\nimport {\n  REGISTER_SUCCESS,\n  REGISTER_FAIL,\n  CLIENT_LOADED,\n  AUTH_ERROR,\n  LOGIN_SUCCESS,\n  LOGIN_FAIL,\n  LOGOUT,\n  CLEAR_ERRORS,\n  UPDATE_CLIENT,\n  UPDATE_DADOS,\n  UPDATE_PASSWORD\n} from \"../types\";\n\nconst AuthState = props => {\n  const initialState = {\n    token: localStorage.getItem(\"token\"),\n    isAuthenticated: null,\n    loading: true,\n    client: \"\",\n    error: null\n  };\n\n  const [state, dispatch] = useReducer(authReducer, initialState);\n\n  // Load Cliente\n  const loadCliente = async () => {\n    setAuthToken(localStorage.token);\n\n    try {\n      const res = await axios.get(\"/api/auth\");\n\n      dispatch({\n        type: CLIENT_LOADED,\n        payload: res.data\n      });\n    } catch (err) {\n      dispatch({ type: AUTH_ERROR });\n    }\n  };\n\n  // Registo de Cliente\n  const register = async formData => {\n    const config = {\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    };\n\n    try {\n      const res = await axios.post(\"/api/clientes\", formData, config);\n\n      dispatch({\n        type: REGISTER_SUCCESS,\n        payload: res.data\n      });\n\n      loadCliente();\n    } catch (err) {\n      dispatch({\n        type: REGISTER_FAIL,\n        payload: err.response.data.msg\n      });\n    }\n  };\n\n  // Login Cliente\n  const login = async formData => {\n    const config = {\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    };\n\n    try {\n      const res = await axios.post(\"/api/auth\", formData, config);\n\n      dispatch({\n        type: LOGIN_SUCCESS,\n        payload: res.data\n      });\n\n      loadCliente();\n    } catch (err) {\n      dispatch({\n        type: LOGIN_FAIL,\n        payload: err.response.data.msg\n      });\n    }\n  };\n\n  // Update Client\n  const updateDados = async client => {\n    const config = {\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    };\n\n    try {\n      const res = await axios.put(\n        `/api/clientes/${client._id}`,\n        client,\n        config\n      );\n\n      dispatch({\n        type: UPDATE_DADOS,\n        payload: res.data\n      });\n    } catch (err) {\n      dispatch({\n        type: AUTH_ERROR,\n        payload: err.response.msg\n      });\n    }\n  };\n\n  // Update Client Password\n  const updatePassword = async client => {\n    const config = {\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    };\n\n    try {\n      const res = await axios.put(\n        `/api/clientes/senha/${client._id}`,\n        client,\n        config\n      );\n\n      dispatch({\n        type: UPDATE_PASSWORD,\n        payload: res.data\n      });\n    } catch (err) {\n      dispatch({\n        type: AUTH_ERROR,\n        payload: err.response.msg\n      });\n    }\n  };\n\n  // Update Client\n  const updateClient = async client => {\n    try {\n      dispatch({\n        type: UPDATE_CLIENT,\n        payload: client\n      });\n    } catch (err) {\n      dispatch({\n        type: AUTH_ERROR,\n        payload: err.response.msg\n      });\n    }\n  };\n\n  // Logout\n  const logout = () => dispatch({ type: LOGOUT });\n\n  // Clear Errors\n  const clearErrors = () => dispatch({ type: CLEAR_ERRORS });\n\n  return (\n    <AuthContext.Provider\n      value={{\n        token: state.token,\n        isAuthenticated: state.isAuthenticated,\n        loading: state.loading,\n        client: state.client,\n        error: state.error,\n        register,\n        loadCliente,\n        login,\n        logout,\n        clearErrors,\n        updateClient,\n        updateDados,\n        updatePassword\n      }}\n    >\n      {props.children}\n    </AuthContext.Provider>\n  );\n};\n\nexport default AuthState;\n"]},"metadata":{},"sourceType":"module"}